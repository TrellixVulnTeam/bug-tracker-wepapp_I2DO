{"ast":null,"code":"import _asyncToGenerator from \"/home/geri/Documents/angular-frontend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as Notifications from 'src/app/interfaces/globalNotifications/notifications';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/priority/priority.service\";\nimport * as i3 from \"src/app/services/ticket/ticket.service\";\nimport * as i4 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i5 from \"src/app/services/auth/auth.service\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/common\";\n\nfunction AddTicketComponent_button_46_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function AddTicketComponent_button_46_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const prio_r7 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.setPriority(prio_r7);\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const prio_r7 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\" Type: \", prio_r7.priorityType, \" | Importance: \", prio_r7.importance, \" (higher the more important) \");\n  }\n}\n\nfunction AddTicketComponent_ng_template_61_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\", 30);\n    i0.ɵɵlistener(\"mouseenter\", function AddTicketComponent_ng_template_61_Template_span_mouseenter_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const date_r10 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.hoveredDate = date_r10;\n    })(\"mouseleave\", function AddTicketComponent_ng_template_61_Template_span_mouseleave_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.hoveredDate = null;\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const date_r10 = ctx.$implicit;\n    const focused_r11 = ctx.focused;\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"focused\", focused_r11)(\"range\", ctx_r6.isRange(date_r10))(\"faded\", ctx_r6.isHovered(date_r10) || ctx_r6.isInside(date_r10));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", date_r10.day, \" \");\n  }\n}\n\nexport let AddTicketComponent = /*#__PURE__*/(() => {\n  class AddTicketComponent {\n    constructor(router, priorityService, ticketService, calendar, authService) {\n      this.router = router;\n      this.priorityService = priorityService;\n      this.ticketService = ticketService;\n      this.calendar = calendar;\n      this.authService = authService;\n      this.hoveredDate = null;\n      this.toDate = null;\n      this.selectedStatus = \"\";\n      const navigation = this.router.getCurrentNavigation();\n\n      if (navigation) {\n        this.project = navigation.extras.state ? navigation.extras.state.project : 0;\n      } //On page refresh, the state is lost along with the object so I reroute the user back to projects \n\n\n      if (this.project.id == null) {\n        this.router.navigateByUrl(\"/projects\");\n      }\n    }\n\n    ngOnInit() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        _this.priorities = yield _this.priorityService.getPriorities().toPromise();\n        _this.fromDate = _this.calendar.getToday();\n        _this.toDate = _this.calendar.getNext(_this.calendar.getToday(), 'd', 10);\n      })();\n    }\n\n    setPriority(priority) {\n      this.selectedPriority = priority;\n    }\n\n    setStatus(status) {\n      this.selectedStatus = status;\n    }\n\n    onAddTicket(addTicketForm) {\n      var _this2 = this;\n\n      return _asyncToGenerator(function* () {\n        var _a, _b;\n\n        const ticketTitle = (_a = addTicketForm.form.get('ticket_title')) === null || _a === void 0 ? void 0 : _a.value;\n        const ticketDesc = (_b = addTicketForm.form.get('ticket_desc')) === null || _b === void 0 ? void 0 : _b.value; //apparently months start at 0 in js so we need to take 1 away....\n\n        const startedDate = new Date(_this2.fromDate.year, _this2.fromDate.month - 1, _this2.fromDate.day);\n        let userId = localStorage.getItem(\"user_id\") ? Number(localStorage.getItem(\"user_id\")) : 0;\n\n        if (_this2.toDate !== null) {\n          const deadline = new Date(_this2.toDate.year, _this2.toDate.month - 1, _this2.toDate.day);\n          console.log(`Ticket title: ${ticketTitle}\\n Ticket desc: ${ticketDesc}\\n deadline: ${deadline}\\n date started: ${startedDate}\n      \\n ticker prio: ${_this2.selectedPriority.priorityType}\\n status: ${_this2.selectedStatus}\\n project: ${_this2.project.id}`);\n          let newTicket = {\n            ticketTitle: ticketTitle,\n            ticketDesc: ticketDesc,\n            ticketCreated: startedDate,\n            deadline: deadline,\n            status: _this2.selectedStatus,\n            ticketPriority: {},\n            id: 0,\n            project: {},\n            submitUser: {},\n            assignedUser: {},\n            comments: {},\n            ticketHistory: {},\n            tags: [] //this being null gave error idk\n\n          }; //creates 2 new user, new priority, new project and adds one of the two new users as assigned user\n\n          _this2.ticketService.addTicket(_this2.selectedPriority.id, _this2.project.id, userId, newTicket).subscribe(response => {\n            //alert(\"Ticket Added\")\n            Notifications.addNewAlert(`Ticket Created: ${response.ticketTitle} `, \"success\");\n\n            _this2.router.navigateByUrl('tickets/ticket', {\n              state: {\n                ticket: response\n              }\n            });\n          }, error => {\n            alert(\"You have no access rights to the project according to your token\");\n          });\n        } else {\n          alert(\"Deadline not selected\");\n        }\n      })();\n    }\n\n    onDateSelection(date) {\n      if (!this.fromDate && !this.toDate) {\n        this.fromDate = date;\n      } else if (this.fromDate && !this.toDate && date.after(this.fromDate)) {\n        this.toDate = date;\n      } else {\n        this.toDate = null;\n        this.fromDate = date;\n      }\n    }\n\n    isHovered(date) {\n      return this.fromDate && !this.toDate && this.hoveredDate && date.after(this.fromDate) && date.before(this.hoveredDate);\n    }\n\n    isInside(date) {\n      return this.toDate && date.after(this.fromDate) && date.before(this.toDate);\n    }\n\n    isRange(date) {\n      return date.equals(this.fromDate) || this.toDate && date.equals(this.toDate) || this.isInside(date) || this.isHovered(date);\n    }\n\n  }\n\n  AddTicketComponent.ɵfac = function AddTicketComponent_Factory(t) {\n    return new (t || AddTicketComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.PriorityService), i0.ɵɵdirectiveInject(i3.TicketService), i0.ɵɵdirectiveInject(i4.NgbCalendar), i0.ɵɵdirectiveInject(i5.AuthService));\n  };\n\n  AddTicketComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddTicketComponent,\n    selectors: [[\"app-add-ticket\"]],\n    decls: 69,\n    vars: 13,\n    consts: [[1, \"content\"], [1, \"container-fluid\"], [1, \"row\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"card-header\", \"card-header-primary\"], [1, \"card-title\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"addTicketForm\", \"ngForm\"], [1, \"form-group\"], [1, \"bmd-label-floating\"], [\"type\", \"text\", \"ngModel\", \"\", \"name\", \"ticket_title\", \"required\", \"\", \"maxlength\", \"50\", 1, \"form-control\"], [\"input\", \"\"], [\"type\", \"text\", \"ngModel\", \"\", \"name\", \"ticket_desc\", \"required\", \"\", \"maxlength\", \"1000\", 1, \"form-control\"], [1, \"col-md-2\"], [\"ngbDropdown\", \"\", 1, \"d-inline-block\"], [\"id\", \"priorityDropDown\", \"ngbDropdownToggle\", \"\", \"type\", \"button\", 1, \"btn\", \"btn-outline-primary\"], [\"ngbDropdownMenu\", \"\", \"aria-labelledby\", \"priorityDropDown\"], [\"ngbDropdownItem\", \"\", \"type\", \"button\", 3, \"click\"], [\"align-items\", \"center\", 1, \"col-md-2\", \"center\"], [\"text-align\", \"center\", \"vertical-align\", \"middle\", 1, \"bmd-label-floating\", \"center\"], [\"ngbDropdownItem\", \"\", \"type\", \"button\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"align-items\", \"center\", 1, \"col-md-4\", \"center\"], [\"ngModel\", \"\", \"name\", \"ticket_deadline\", \"outsideDays\", \"hidden\", 1, \"btn\", \"btn-primary\", \"btn-link\", \"btn-sm\", 3, \"displayMonths\", \"dayTemplate\", \"dateSelect\"], [\"dp\", \"\"], [\"t\", \"\"], [1, \"text-primary\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"pull-right\", 3, \"disabled\"], [1, \"clearfix\"], [1, \"custom-day\", \"btn\", \"btn-primary\", \"btn-link\", \"btn-sm\", 3, \"mouseenter\", \"mouseleave\"]],\n    template: function AddTicketComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r15 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"div\", 4);\n        i0.ɵɵelementStart(5, \"div\", 5);\n        i0.ɵɵelementStart(6, \"h4\", 6);\n        i0.ɵɵtext(7, \"Create Ticket\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 7);\n        i0.ɵɵelementStart(9, \"form\", 8, 9);\n        i0.ɵɵlistener(\"ngSubmit\", function AddTicketComponent_Template_form_ngSubmit_9_listener() {\n          i0.ɵɵrestoreView(_r15);\n\n          const _r0 = i0.ɵɵreference(10);\n\n          return ctx.onAddTicket(_r0);\n        });\n        i0.ɵɵelementStart(11, \"div\", 2);\n        i0.ɵɵelementStart(12, \"div\", 3);\n        i0.ɵɵelementStart(13, \"div\", 10);\n        i0.ɵɵelementStart(14, \"label\", 11);\n        i0.ɵɵtext(15, \"Ticket Title\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(16, \"input\", 12, 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"div\", 2);\n        i0.ɵɵelementStart(19, \"div\", 3);\n        i0.ɵɵelementStart(20, \"div\", 10);\n        i0.ɵɵelementStart(21, \"label\", 11);\n        i0.ɵɵtext(22, \"Ticket Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(23, \"input\", 14, 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"div\", 2);\n        i0.ɵɵelementStart(26, \"div\", 15);\n        i0.ɵɵelementStart(27, \"div\", 16);\n        i0.ɵɵelementStart(28, \"button\", 17);\n        i0.ɵɵtext(29, \" Status \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"div\", 18);\n        i0.ɵɵelementStart(31, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function AddTicketComponent_Template_button_click_31_listener() {\n          return ctx.setStatus(\"OPEN\");\n        });\n        i0.ɵɵtext(32, \" Open \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function AddTicketComponent_Template_button_click_33_listener() {\n          return ctx.setStatus(\"CLOSED\");\n        });\n        i0.ɵɵtext(34, \" Closed \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"button\", 19);\n        i0.ɵɵlistener(\"click\", function AddTicketComponent_Template_button_click_35_listener() {\n          return ctx.setStatus(\"ONHOLD\");\n        });\n        i0.ɵɵtext(36, \" On Hold \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(37, \"div\", 20);\n        i0.ɵɵelementStart(38, \"label\", 21);\n        i0.ɵɵtext(39);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"div\", 2);\n        i0.ɵɵelementStart(41, \"div\", 15);\n        i0.ɵɵelementStart(42, \"div\", 16);\n        i0.ɵɵelementStart(43, \"button\", 17);\n        i0.ɵɵtext(44, \" Priority \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(45, \"div\", 18);\n        i0.ɵɵtemplate(46, AddTicketComponent_button_46_Template, 2, 2, \"button\", 22);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"div\", 23);\n        i0.ɵɵelementStart(48, \"label\", 21);\n        i0.ɵɵtext(49);\n        i0.ɵɵelement(50, \"br\");\n        i0.ɵɵtext(51);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(52, \"div\", 20);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(53, \"div\", 2);\n        i0.ɵɵelementStart(54, \"div\", 3);\n        i0.ɵɵelementStart(55, \"div\", 10);\n        i0.ɵɵelementStart(56, \"label\", 11);\n        i0.ɵɵtext(57, \"Ticket Start & Deadline\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(58, \"div\");\n        i0.ɵɵelementStart(59, \"ngb-datepicker\", 24, 25);\n        i0.ɵɵlistener(\"dateSelect\", function AddTicketComponent_Template_ngb_datepicker_dateSelect_59_listener($event) {\n          return ctx.onDateSelection($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(61, AddTicketComponent_ng_template_61_Template, 2, 7, \"ng-template\", null, 26, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵelement(63, \"hr\");\n        i0.ɵɵelementStart(64, \"pre\", 27);\n        i0.ɵɵtext(65);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(66, \"button\", 28);\n        i0.ɵɵtext(67, \" Create Ticket \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(68, \"div\", 29);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(10);\n\n        const _r5 = i0.ɵɵreference(62);\n\n        i0.ɵɵadvance(39);\n        i0.ɵɵtextInterpolate1(\"Ticket Status: \", ctx.selectedStatus.toLowerCase(), \" \");\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngForOf\", ctx.priorities);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"Ticket Priority: \", ctx == null ? null : ctx.selectedPriority == null ? null : ctx.selectedPriority.priorityType, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate1(\" Importance level: \", ctx == null ? null : ctx.selectedPriority == null ? null : ctx.selectedPriority.importance, \" \");\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"displayMonths\", 2)(\"dayTemplate\", _r5);\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate6(\"From: \", ctx.fromDate.year, \"/\", ctx.fromDate.month, \"/\", ctx.fromDate.day, \" To: \", ctx == null ? null : ctx.toDate == null ? null : ctx.toDate.year, \"/\", ctx == null ? null : ctx.toDate == null ? null : ctx.toDate.month, \"/\", ctx == null ? null : ctx.toDate == null ? null : ctx.toDate.day, \"\\n                        \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", !_r0.valid);\n      }\n    },\n    directives: [i6.ɵNgNoValidate, i6.NgControlStatusGroup, i6.NgForm, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgModel, i6.RequiredValidator, i6.MaxLengthValidator, i4.NgbDropdown, i4.NgbDropdownToggle, i4.NgbDropdownMenu, i4.NgbDropdownItem, i7.NgForOf, i4.NgbDatepicker],\n    styles: [\"\", \".custom-day[_ngcontent-%COMP%]{text-align:center;padding:.185rem .25rem;display:inline-block;height:2rem;width:2rem}.custom-day.focused[_ngcontent-%COMP%]{background-color:#e6e6e6}.custom-day.range[_ngcontent-%COMP%], .custom-day[_ngcontent-%COMP%]:hover{background-color:#0275d8;color:#fff}.custom-day.faded[_ngcontent-%COMP%]{background-color:#0275d880}\"]\n  });\n  return AddTicketComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}